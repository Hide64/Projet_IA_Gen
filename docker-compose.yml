services:
  app:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: movie-mood-reco
    env_file:
      - .env
    ports:
      - "8501:8501"
    volumes:
      # Code (dev-friendly)
      - ./app:/app/app
      # DonnÃ©es persistantes
      - ./data:/app/data
      - ./storage:/app/storage
    command: >
      streamlit run app/ui/streamlit_app.py
      --server.port=8501
      --server.address=0.0.0.0
      --server.headless=true
  postgres:
    #image: postgres:16
    image: pgvector/pgvector:pg16
    container_name: tp_postgres
    environment:
      POSTGRES_DB: videotheque
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
    ports:
      - "5432:5432"
    volumes:
      - pgdata:/var/lib/postgresql/data
      - ./postgres/init:/docker-entrypoint-initdb.d:ro
      - ./postgres/seed:/seed:ro
    healthcheck:
      test: ["CMD-SHELL", "pg_isready -U postgres -d videotheque"]
      interval: 5s
      timeout: 5s
      retries: 10
  ollama:
      image: ollama/ollama:latest
      container_name: ollama
      ports:
        - "11434:11434"
      volumes:
        - ollama:/root/.ollama

volumes:
  pgdata:
  ollama:
